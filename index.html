<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEⅠ GS Quiz</title>
    <!-- PWA manifest link -->
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Tone.js library for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        /* CSS Variables for Theming */
        :root {
            /* Light Mode Default Colors */
            --bg-primary: #e0e7ff;
            --bg-secondary: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --button-bg-default: #f0f4f8;
            --button-text-default: #34495e;
            --button-border-default: #dbe2ef;
            --nav-button-bg: #6c5ce7;
            --nav-button-hover-bg: #5a4acb;
            --nav-button-shadow: rgba(108, 92, 231, 0.3);
            --start-button-bg: #2ecc71;
            --start-button-hover-bg: #27ae60;
            --start-button-shadow: rgba(46, 204, 113, 0.3);
            --interrupt-button-bg: #e74c3c;
            --interrupt-button-hover-bg: #c0392b;
            --interrupt-button-shadow: rgba(231, 76, 60, 0.3);
            --progress-bar-bg: #6c5ce7;
            --feedback-bg: #fdfdfd;
            --feedback-border: #e0e0e0;
            --correct-feedback-text: #1a5e20;
            --correct-feedback-border: #28a745;
            --incorrect-feedback-text: #721c24;
            --incorrect-feedback-border: #dc3545;
            --correct-option-bg: #c8e6c9;
            --incorrect-option-bg: #f0b2b2;
            --score-color: #1e3a8a;
            --score-comment-color: #4f46e5;
            --settings-button-bg: #3498db;
            --settings-button-hover-bg: #2980b9;
            --settings-button-shadow: rgba(52, 152, 219, 0.3);
        }

        /* Dark Mode Colors */
        body.dark-mode {
            --bg-primary: #1a1a2e;
            --bg-secondary: #212a3d;
            --text-primary: #e0e7ff;
            --text-secondary: #9bb0d9;
            --button-bg-default: #3a4a5c;
            --button-text-default: #e0e7ff;
            --button-border-default: #5c708a;
            --nav-button-bg: #6a3a82;
            --nav-button-hover-bg: #5a306e;
            --nav-button-shadow: rgba(106, 58, 130, 0.3);
            --start-button-bg: #1e8247;
            --start-button-hover-bg: #1a6e3c;
            --start-button-shadow: rgba(30, 130, 71, 0.3);
            --interrupt-button-bg: #a93226;
            --interrupt-button-hover-bg: #922a1f;
            --interrupt-button-shadow: rgba(169, 50, 38, 0.3);
            --progress-bar-bg: #6a3a82;
            --feedback-bg: #324054;
            --feedback-border: #4a5a6e;
            --correct-feedback-text: #c8e6c9;
            --correct-feedback-border: #28a745;
            --incorrect-feedback-text: #f0b2b2;
            --incorrect-feedback-border: #dc3545;
            --correct-option-bg: #2d6a4a;
            --incorrect-option-bg: #8c3b3b;
            --score-color: #e0e7ff;
            --score-comment-color: #b886d9;
            --settings-button-bg: #2471a3;
            --settings-button-hover-bg: #1f608a;
            --settings-button-shadow: rgba(36, 113, 163, 0.3);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
            transition: background-color 0.3s ease;
        }
        .container {
            background-color: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            padding: 25px;
            padding-top: 50px;
            width: 100%;
            max-width: 600px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 15px; /* Reduced gap */
            position: relative;
            z-index: 1;
            transition: background-color 0.3s ease;
        }
        .screen {
            display: none;
            flex-direction: column;
            gap: 15px; /* Reduced gap */
        }
        .screen.active {
            display: flex;
        }
        .question-area {
            min-height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--feedback-bg);
            border-radius: 10px;
            padding: 15px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease;
        }
        .question-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }
        .hint-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
            transition: color 0.3s ease;
        }
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 15px;
        }
        .option-button {
            background-color: var(--button-bg-default);
            color: var(--button-text-default);
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--button-border-default);
            text-align: left;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        .option-button:hover {
            background-color: var(--button-border-default);
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.12);
        }
        .option-button.correct {
            background-color: var(--correct-option-bg);
            border-color: var(--correct-feedback-border);
            color: var(--correct-feedback-text);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.2);
        }
        .option-button.incorrect {
            background-color: var(--incorrect-option-bg);
            border-color: var(--incorrect-feedback-border);
            color: var(--incorrect-feedback-text);
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.2);
        }
        .navigation-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .nav-button {
            background-color: var(--nav-button-bg);
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 5px 15px var(--nav-button-shadow);
            flex-grow: 1;
            min-width: 120px;
        }
        .nav-button:hover {
            background-color: var(--nav-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 7px 20px var(--nav-button-shadow);
        }
        .nav-button:disabled {
            background-color: #a7a7a7;
            cursor: not-allowed;
            box-shadow: none;
        }
        .feedback-message {
            margin-top: 10px; /* Reduced margin */
            font-size: 1rem;
            font-weight: 600;
            text-align: left;
            padding: 10px 15px; /* Reduced vertical padding */
            border-radius: 12px;
            background-color: var(--feedback-bg);
            border: 1px solid var(--feedback-border);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            line-height: 1.5;
            transition: all 0.3s ease;
        }
        .feedback-message.correct-feedback {
            color: var(--correct-feedback-text);
            border-color: var(--correct-feedback-border);
        }
        .feedback-message.incorrect-feedback {
            color: var(--incorrect-feedback-text);
            border-color: var(--incorrect-feedback-border);
        }
        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            min-height: 24px;
        }
        .feedback-result {
            flex-grow: 1;
        }
        .feedback-result strong {
            font-size: 1.1rem;
        }
        .explanation-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding-top 0.4s ease-out, margin-top 0.4s ease-out;
            padding-top: 0;
            margin-top: 0;
        }
        .explanation-content.show {
            max-height: 200px;
            padding-top: 10px;
            margin-top: 10px;
            border-top: 1px solid var(--feedback-border);
        }
        .explanation-text {
            font-weight: 400;
            font-size: 0.95rem;
            transition: color 0.3s ease;
        }
        .feedback-message.correct-feedback .explanation-text {
            color: var(--correct-feedback-text);
        }
        .feedback-message.incorrect-feedback .explanation-text {
            color: var(--incorrect-feedback-text);
        }
        .toggle-explanation-button {
            background-color: var(--nav-button-bg);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px var(--nav-button-shadow);
            flex-shrink: 0;
        }
        .toggle-explanation-button:hover {
            transform: translateY(-1px);
        }
        .toggle-explanation-button.hidden {
            display: none;
        }

        .score-area {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--score-color);
            margin-top: 25px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            transition: color 0.3s ease;
        }
        .score-comment {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--score-comment-color);
            margin-top: 10px;
            transition: color 0.3s ease;
        }
        .mode-selection-dropdown, .question-count-selection {
            margin-bottom: 15px;
        }
        .mode-selection-dropdown label, .question-count-selection label {
            display: block;
            text-align: left;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .mode-selection-dropdown select, .question-count-selection select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--button-border-default);
            font-size: 1rem;
            background-color: var(--button-bg-default);
            color: var(--button-text-default);
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22%23333%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M5.293%207.293a1%201%200%20011.414%200L10%2010.586l3.293-3.293a1%201%200%20111.414%201.414l-4%204a1%201%200%2001-1.414%200l-4-4a1%201%200%20010-1.414z%22%20clip-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 1.2em;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        .start-button {
            background-color: var(--start-button-bg);
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px var(--start-button-shadow);
            margin-top: 20px;
        }
        .start-button:hover {
            background-color: var(--start-button-hover-bg);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--start-button-shadow);
        }
        #settingsButton {
            background-color: var(--settings-button-bg);
            box-shadow: 0 5px 15px var(--settings-button-shadow);
        }

        /* モーダル */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: var(--bg-secondary);
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 90%;
            transform: translateY(-30px);
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .modal.show .modal-content {
            transform: translateY(0);
        }
        .modal-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--score-color);
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }
        .modal-message {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            line-height: 1.6;
            transition: color 0.3s ease;
        }
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .modal-button {
            background-color: var(--nav-button-bg);
            color: white;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px var(--nav-button-shadow);
        }
        .modal-button:hover {
            background-color: var(--nav-button-hover-bg);
            transform: translateY(-1px);
        }
        #modalCancelButton {
            background-color: #7f8c8d;
            box-shadow: 0 4px 10px rgba(127, 140, 141, 0.3);
        }
        #modalCancelButton:hover {
            background-color: #616e7c;
        }


        /* プログレスバー */
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            height: 15px;
            margin-top: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--progress-bar-bg);
            border-radius: 10px;
            transition: width 0.3s ease-in-out, background-color 0.3s ease;
        }
        .progress-text {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 10px;
            transition: color 0.3s ease;
        }

        /* 中断ボタンのスタイル */
        #interruptButton {
            background-color: var(--interrupt-button-bg);
            box-shadow: 0 5px 15px var(--interrupt-button-shadow);
            position: absolute;
            top: 15px;
            right: 15px;
            left: unset;
            padding: 8px 15px;
            font-size: 0.8rem;
            z-index: 10;
            flex-grow: 0;
            min-width: unset;
        }
        #interruptButton:hover {
            background-color: var(--interrupt-button-hover-bg);
        }

        /* コンフェッティアニメーション */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }
        .confetti {
            position: absolute;
            bottom: -10px;
            width: 8px;
            height: 12px;
            background-color: #f06;
            opacity: 0;
        }
        .confetti:nth-child(2n) { background-color: #6cf; }
        .confetti:nth-child(3n) { background-color: #fc0; }
        .confetti:nth-child(4n) { background-color: #0c6; }
        .confetti:nth-child(5n) { background-color: #93f; }

        /* Settings Screen Specific Styles */
        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--button-border-default);
        }
        .settings-option:last-child {
            border-bottom: none;
        }
        .settings-option label {
            font-size: 1.1rem;
            color: var(--text-primary);
            font-weight: 600;
        }
        .theme-colors {
            display: flex;
            gap: 10px;
        }
        .color-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
        }
        .color-circle.selected {
            border-color: var(--nav-button-bg);
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--nav-button-bg);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        @media (min-width: 640px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
            .nav-button {
                min-width: unset;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-extrabold text-indigo-800 mb-6" style="color: var(--score-color);">BEⅠ GS Quiz</h1>

        <!-- スタート画面 -->
        <div id="startScreen" class="screen active">
            <p class="text-lg mb-4" style="color: var(--text-primary);">学習したいモードを選択してください。</p>
            <div class="mode-selection-dropdown">
                <select id="quizModeSelect">
                    <option value="random-10">全レッスンからランダム10問</option>
                    <option value="incorrect">苦手克服モード</option>
                    <option value="GS_I-1">レッスン 1-1 (名詞・代名詞)</option>
                    <option value="GS_I-2">レッスン 1-2 (冠詞、形容詞・副詞)</option>
                    <option value="GS_I-3">レッスン 1-3 (動詞、助動詞、時制)</option>
                    <option value="GS_I-4">レッスン 1-4 (動名詞の構文・関係詞の構文)</option>
                    <option value="GS_I-5">レッスン 1-5 (不定詞の構文)</option>
                    <option value="GS_I-6">レッスン 1-6 (時を表す構文、否定を表す構文)</option>
                    <option value="GS_I-7">レッスン 1-7 (分詞)</option>
                    <option value="GS_I-8">レッスン 1-8 (仮定法)</option>
                    <option value="GS_I-9">レッスン 1-9 (比較)</option>
                    <option value="GS_I-10">レッスン 1-10 (接続詞)</option>
                </select>
            </div>
            <button id="startButton" class="start-button">クイズ開始</button>
            <button id="settingsButton" class="nav-button">設定</button>
        </div>

        <!-- クイズ画面 -->
        <div id="quizScreen" class="screen">
            <button id="interruptButton" class="nav-button">中断する</button>
            <div class="progress-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div id="progressText" class="progress-text"></div>

            <div class="question-area">
                <div id="questionText" class="question-text"></div>
                <div id="hintText" class="hint-text"></div>
            </div>

            <div id="optionsGrid" class="options-grid"></div>

            <div id="feedbackMessage" class="feedback-message">
                <div class="feedback-header">
                    <div id="feedbackResult"></div>
                    <button id="toggleExplanationButton" class="toggle-explanation-button hidden">解説▼</button>
                </div>
                <div id="explanationContent" class="explanation-content">
                    <div class="explanation-text"></div>
                </div>
            </div>

            <div class="navigation-buttons">
                <button id="nextButton" class="nav-button">次の問題</button>
            </div>
        </div>

        <!-- 結果画面 -->
        <div id="resultScreen" class="screen">
            <h2 class="text-2xl font-bold mb-4" style="color: var(--score-color);">クイズ結果</h2>
            <div id="finalScore" class="score-area"></div>
            <div id="scoreComment" class="score-comment"></div>
            <div id="confettiContainer" class="confetti-container"></div>
            <button id="restartButton" class="nav-button mt-6">もう一度プレイ</button>
            <button id="redoIncorrectButton" class="nav-button mt-2" style="background-color: var(--interrupt-button-bg);">間違えた問題をもう一度やる</button>
        </div>

        <!-- 設定画面 -->
        <div id="settingsScreen" class="screen">
            <h2 class="text-2xl font-bold mb-4" style="color: var(--score-color);">設定</h2>
            <div class="settings-option">
                <label for="darkModeToggle">ダークモード</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label>テーマカラー</label>
                <div class="theme-colors">
                    <div class="color-circle" data-theme="default" style="background-color: #6c5ce7;"></div>
                    <div class="color-circle" data-theme="red" style="background-color: #e74c3c;"></div>
                    <div class="color-circle" data-theme="green" style="background-color: #2ecc71;"></div>
                    <div class="color-circle" data-theme="orange" style="background-color: #f39c12;"></div>
                </div>
            </div>
            <div class="settings-option">
                <label for="questionCountSelect">問題数</label>
                <select id="questionCountSelect">
                    <option value="5">5問</option>
                    <option value="10">10問</option>
                    <option value="15">15問</option>
                    <option value="20">20問</option>
                </select>
            </div>
            <div class="settings-option">
                <label for="showProgressToggle">進捗状況</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="showProgressToggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label for="enableSoundToggle">効果音</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enableSoundToggle">
                    <span class="slider"></span>
                </label>
            </div>
            <button id="backToStartButton" class="nav-button mt-6">戻る</button>
        </div>
    </div>

    <!-- モーダル -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle" class="modal-title"></h2>
            <p id="modalMessage" class="modal-message"></p>
            <div class="modal-buttons">
                <button id="modalConfirmButton" class="modal-button">はい</button>
                <button id="modalCancelButton" class="modal-button">キャンセル</button>
            </div>
        </div>
    </div>

    <script>
        // 問題データ (省略 - 元のコードと同じ)
        const allQuestions = [
            // GS_I-1 (名詞・代名詞)
            { id: '1-1', lesson: 'GS_I-1', text: "There was ______ on television this morning about e-sports.", hint: "(1つのとても面白いニュース)", options: ["a very interesting news", "very interesting news", "a piece of very interesting news", "many interesting news"], answer: "a piece of very interesting news", explanation: "newsのような不可算名詞を数えるときには 'a piece of~' を使います。2つだったら 'two pieces of -' となります。他の不可算名詞の例: a piece of information, two pieces of furniture, three pieces of advice" },
            { id: '1-2', lesson: 'GS_I-1', text: "The coach gave me ______.", hint: "(コーチはほとんどアドバイスをくれなかった)", options: ["few advice", "little advice", "much advice", "an advice"], answer: "little advice", explanation: "adviceは抽象名詞（不可算）なので、ほとんどない場合は 'little' を使います。（可算の場合は 'few'）たくさんのアドバイスの場合は 'much advice' となります。" },
            { id: '1-3', lesson: 'GS_I-1', text: "There is always ______ in the city center.", hint: "(ひどい渋滞)", options: ["many traffic", "a heavy traffic", "heavy traffic", "a little traffic"], answer: "heavy traffic", explanation: "trafficは不可算名詞です。'heavy traffic' で「ひどい渋滞」を意味します。'little traffic' は「ほとんど渋滞がない」です。" },
            { id: '1-4', lesson: 'GS_I-1', text: "There was ______ at the piano recital last night.", hint: "(聴衆がたくさんいた)", options: ["many audience", "a large audience", "much audience", "a few audience"], answer: "a large audience", explanation: "audience（観客）が多い・少ないという時は 'large / small' を使います。例: a large population（人口）, a small income（収入）" },
            { id: '1-5', lesson: 'GS_I-1', text: "My report, as compared with ______, is nothing.", hint: "(彼のレポートと比べてみると)", options: ["his report", "him", "his", "he"], answer: "his", explanation: "英語は繰り返しを避けるため、'his report' の略として所有代名詞 'his' を使います。" },
            { id: '1-6', lesson: 'GS_I-1', text: "I was surprised because ______ suddenly showed up at the door of my house.", hint: "(私の古い友だちが)", options: ["my old friend", "an old friend of mine", "an old friend of me", "my old friend's"], answer: "an old friend of mine", explanation: "'a [the/that/some/any/no]+名詞+of+mine/yours/his/her/ours' の形を使います。例: of this old camera of mine（私のこの古いカメラ）" },
            { id: '1-7', lesson: 'GS_I-1', text: "Would you give me ______?", hint: "(何か暖かい着るもの)", options: ["warm something to wear", "something warm to wear", "something to wear warm", "to wear something warm"], answer: "something warm to wear", explanation: "'something [anything/everything/nothing]+形容詞的要素+to不定詞' の形を使います。例: This book has everything you need to learn." },
            { id: '1-8', lesson: 'GS_I-1', text: "When it comes to the problem of global warming, ______ easy solution.", hint: "(誰も容易な解決策を見つけることができない)", options: ["anyone can find no", "nobody can find any", "no one can find no", "everyone can find no"], answer: "nobody can find any", explanation: "'nobody can' で「誰も〜できない」（否定）を意味します。'nobody' があるので、続く名詞は 'any' を使います。" },
            { id: '1-9', lesson: 'GS_I-1', text: "We searched for the two boys everywhere, but ______ could be found.", hint: "(どちらも見つからなかった)", options: ["both", "either", "neither", "none"], answer: "neither", explanation: "'neither' は「どちらも〜ない」（否定）を意味します。例: Neither of us could understand what he was saying." },
            { id: '1-10', lesson: 'GS_I-1', text: "I've put money on two horses. If ______ wins, I shall make a fortune.", hint: "(もしどちらかが勝ったら)", options: ["both of them", "either of them", "neither of them", "any of them"], answer: "either of them", explanation: "'either of' は「〜のうちどちらか」（単数扱いなので動詞は現在形）を意味します。'either of' の後は 'us' や 'them' のような複数形代名詞か 'the + 複数形' が基本です。" },
            { id: '1-11', lesson: 'GS_I-1', text: "______ a prize.", hint: "(勝者それぞれが1つずつ賞をもらう)", options: ["All of the winners get", "Each of the winners gets", "Every of the winners get", "Some of the winners get"], answer: "Each of the winners gets", explanation: "'each of' は「それぞれの〜」（単数扱いなので動詞は現在形）を意味します。'each of' の後は 'us' や 'them' のような複数形代名詞か 'the + 複数形' が基本です。" },
            { id: '1-12', lesson: 'GS_I-1', text: "The climate of Japan is milder than ______ of England.", hint: "(イギリスのそれ)", options: ["it", "that", "those", "this"], answer: "that", explanation: "'the+単数形名詞' を繰り返す時は 'that' を用います。'the + 複数形' の場合は 'those' を用います。" },
            { id: '1-13', lesson: 'GS_I-1', text: "______ like tea, and ______ like coffee.", hint: "(teaを好きな人もいれば、coffee が好きな人もいる)", options: ["Some people / the others", "Some people / others", "Many people / other", "A few people / another"], answer: "Some people / others", explanation: "teaを好きな人は特定の誰かではないので、'some people' を使います。'others' は残りの特定していない人を指します。" },
            { id: '1-14', lesson: 'GS_I-1', text: "There are four reasons for our decisions. You know two of them, so I'll tell you ______.", hint: "(他のもの)", options: ["other", "the other", "others", "the others"], answer: "the others", explanation: "'two of them' は 'four reasons' のことです。これはすでに特定された情報なので、特定の残りのものを現したい時は 'the others' を使います。特定の残りのものが単数だったら 'the other' です。例: We have two children. One is in Tokyo, and the other is in Osaka." },
            { id: '1-15', lesson: 'GS_I-1', text: "Values differ ______.", hint: "(人によって)", options: ["by person", "from person to person", "from one person to another", "between people"], answer: "from one person to another", explanation: "'from one to another' で「〜によって」という意味になります。例: 国によって（異なる）: differ from one country to another" },
            { id: '1-16', lesson: 'GS_I-1', text: "______ passed the examination.", hint: "(ほとんどの学生)", options: ["Most of students", "Almost students", "Most of the students", "Almost all students"], answer: "Most of the students", explanation: "'most of' は「ほとんどの〜」を意味します。'most of' の後は 'us' や 'them' のような複数形代名詞か 'the + 複数形' が基本です。'almost' は副詞なので 'almost of' とは言えません。'almost' を使いたい時は 'all' を補って、'almost all of the books' のように言います。" },
            { id: '2-1', lesson: 'GS_I-2', text: "I visit my grandparents ______.", hint: "(週に2回)", options: ["two times a week", "twice a week", "two weekly", "every two weeks"], answer: "twice a week", explanation: "'twice a week' は「週に2回」を意味します。'once every three weeks' は「3週間に1回」です。" },
            { id: '2-2', lesson: 'GS_I-2', text: "Rice is sold ______.", hint: "(kg 単位で)", options: ["by kilogram", "by the kilogram", "in kilogram", "with kilogram"], answer: "by the kilogram", explanation: "'by the 単位' で「〜単位で」を意味します。例: Part time jobs are usually paid by the hour.（アルバイトは通常時給(時間単位)で払われる。）" },
            { id: '2-3', lesson: 'GS_I-2', text: "Ann ______ when she learned the results of the medical exam.", hint: "(嬉しく感じた)", options: ["felt happy", "felt happily", "was feeling happy", "happy felt"], answer: "felt happy", explanation: "'feel + 形容詞' の形を使います。例: feel sad, feel good, feel sick, feel smooth。'look happy, look sad, taste good, sound strange, keep quiet' なども同様です。" },
            { id: '2-4', lesson: 'GS_I-2', text: "______, John put on his coat, and then picked up his hat.", hint: "(まず最初に)", options: ["Firstly", "The first", "First", "At the first"], answer: "First", explanation: "「まず、まず最初に」は 'First' を使います。'Firstly' や 'The first' は間違いです。他に 'At first' もあります。" },
            { id: '2-5', lesson: 'GS_I-2', text: "He was too tired to go ______.", hint: "(これ以上遠くへ)", options: ["no further", "any further", "furthermore", "some further"], answer: "any further", explanation: "'too... to~' は否定の意味を含むため、'any-' を使います。例: not any more（もうこれ以上〜ない）, I am not staying any longer." },
            { id: '2-6', lesson: 'GS_I-2', text: "What he says ______ at all.", hint: "(意味が通らない)", options: ["has no sense", "makes no sense", "does no sense", "is no sense"], answer: "makes no sense", explanation: "'make no sense' で「意味が通らない」を意味します。'doesn't make any sense' とも言えます。" },
            { id: '2-7', lesson: 'GS_I-2', text: "I am staying for ______.", hint: "(あと2週間)", options: ["other two weeks", "another two weeks", "two more weeks", "two weeks more"], answer: "another two weeks", explanation: "'another~' で「さらに（あと）〜」を意味します。（〜が複数形であっても、'another' を用いる）例: In another ten years, Shibuya will look totally different from what it looks like now." },
            { id: '2-8', lesson: 'GS_I-2', text: "It ______ for you to submit your passport in order to obtain visa.", hint: "(あなたはパスポートを提出する必要がある)", options: ["is necessary", "necessary", "is necessity", "you are necessary"], answer: "is necessary", explanation: "'It is necessary for 人 to 不定詞...' の形を使います。（'You are necessary to' は間違いです）" },
            { id: '2-9', lesson: 'GS_I-2', text: "Please pour me ______.", hint: "(もう少しお茶を注いでください。)", options: ["a few tea", "little tea", "a little tea", "some tea"], answer: "a little tea", explanation: "'a little / a few' は肯定の意味、'little / few' は否定の意味（ほとんどない）です。teaは不可算名詞なので 'a little' を使います。" },
            { id: '2-10', lesson: 'GS_I-2', text: "Does he have any children? Yes, ______.", hint: "(3歳の男の子が(います)。)", options: ["a three-years-old boy", "a three-year-old boy", "three years old boy", "three-year-old boy"], answer: "a three-year-old boy", explanation: "数詞を含む形容詞句は 's' をつけません。例: a ten-minute walk, a two-hour ride, a three-hour-wait line。" },
            { id: '2-11', lesson: 'GS_I-2', text: "I walked ______ of a mile.", hint: "(3/4 (4分の3))", options: ["three-fourth", "three-fourths", "three quarter", "three quarters"], answer: "three-fourths", explanation: "'one-fourth (1/4)' が3つなので 'three-fourths' です。'1/4' は 'a quarter' とも言うので、'three quarters' とも言えます。'1/2' は 'one half' です。" },
            { id: '2-12', lesson: 'GS_I-2', text: "The Olympic Games are held ______.", hint: "(4年ごとに)", options: ["every four years", "every four year", "each four years", "every 4 years"], answer: "every four years", explanation: "'every 数字 years' で「（数字）年ごとに」を意味します。例: every other day（一日おきに）。" },
            { id: '2-13', lesson: 'GS_I-2', text: "The painting is not ______ you are asking.", hint: "(あなたが求めている値段の価値はない)", options: ["worth price", "worth the price", "worthy the price", "worth of the price"], answer: "worth the price", explanation: "'worth + 名詞' で「（名詞）の価値がある」を意味します。'worth -ing' で「〜するだけの価値がある」です。例: It was worth the time.（その時間（を割く）の価値があった）, The book was worth reading.（その本は読む価値があった）。" },
            { id: '2-14', lesson: 'GS_I-2', text: "He is not fond of soccer, and ______.", hint: "(私も好きではない)", options: ["I am not either", "neither am I", "so am I", "I don't either"], answer: "neither am I", explanation: "'not fond of' の部分の繰り返しを避けるために 'neither + 動詞 + 主語' の形を使います。" },
            { id: '2-15', lesson: 'GS_I-2', text: "She ______ home.", hint: "(家に帰った)", options: ["went to", "went", "has gone", "had gone"], answer: "went", explanation: "'home' は副詞なので、'to' は不要です。例: go abroad (x go to abroad)。" },
            { id: '2-16', lesson: 'GS_I-2', text: "Dan was ______ run over by a car.", hint: "(もう少しで、危うく)", options: ["near", "nearly", "almost", "hardly"], answer: "nearly", explanation: "「ほとんど、もう少しで、危うく」は 'nearly' を使います。（'near = 近くに' とは区別する）例: I am nearly done with my homework.（もう少しで宿題が終わる。）" },
            { id: '2-17', lesson: 'GS_I-2', text: "She sat up ______ last night.", hint: "(遅くまで)", options: ["lately", "late", "latter", "latest"], answer: "late", explanation: "「遅く、遅くまで」は 'late' を使います。（'lately = 最近、近ごろ' とは区別する）" },
            { id: '2-18', lesson: 'GS_I-2', text: "We found only ______ customers in the store.", hint: "(少数の客)", options: ["small number of", "a small number of", "few", "a few"], answer: "a small number of", explanation: "'number' には 'small / large' を使います。例: The number of customers in the store was small. 'a large number of' は「多数の〜」です。" },
            { id: '2-19', lesson: 'GS_I-2', text: "Nowadays, some students seek for a job that gives them more free time, rather than ______.", hint: "(高い給料ではなく)", options: ["a high salary", "a big salary", "a tall salary", "a large salary"], answer: "a high salary", explanation: "'salary' や 'price' は 'high/low' を使います。'expensive / cheap' は使いません。" },
            { id: '2-20', lesson: 'GS_I-2', text: "I thought it was a good book, but Jim thought ______.", hint: "(ちがったふうに)", options: ["different", "differently", "otherwise", "other"], answer: "otherwise", explanation: "'otherwise' は「ちがったふうに、別の方法で」を意味します。" },
            { id: '3-1', lesson: 'GS_I-3', text: "I'll ______ the matter with my boss.", hint: "(その件について議論する)", options: ["discuss about", "discuss", "discuss with", "discuss on"], answer: "discuss", explanation: "'discuss' は他動詞なので、'about' などの前置詞は不要です。他に 'consult a dictionary, reach the destination, approach the problem, mention the matter, question the results, answer questions, resemble this picture' などがあります。" },
            { id: '3-2', lesson: 'GS_I-3', text: "Please ______ for a few minutes.", hint: "(席に) 座ったままの状態でいる)", options: ["remain seating", "remain to seat", "remain seated", "remain to be seated"], answer: "remain seated", explanation: "'remain + 補語（形容詞、過去分詞、現在分詞）' の形を使います。例: remain silent, remain shocked, remain standing。" },
            { id: '3-3', lesson: 'GS_I-3', text: "He ______ the book on the desk.", hint: "(本を置いた)", options: ["lay", "lied", "laid", "lain"], answer: "laid", explanation: "'laid' は 'lay'「横たえる、置く（他動詞）」の過去形です。'lay-laid-laid - laying'。'lie-lay-lain - lying' は「横たわる（自動詞）」です。" },
            { id: '3-4', lesson: 'GS_I-3', text: "War doesn't ______ anybody happy.", hint: "(誰も幸せにはしない)", options: ["make", "let", "have", "get"], answer: "make", explanation: "'make + 目的語 + 補語（形容詞・過去分詞など）' で「〜を...にする」を意味します。例: The story told by an astronaut made me inspired." },
            { id: '3-5', lesson: 'GS_I-3', text: "I'm sure you will ______ the book interesting.", hint: "(その本を面白く感じるだろう)", options: ["find", "think", "feel", "make"], answer: "find", explanation: "'find + 目的語 + 補語（現在分詞・過去分詞・形容詞・名詞など）' の形を使います。例: When we opened the door, we found the room empty." },
            { id: '3-6', lesson: 'GS_I-3', text: "My parents never ______ me to swim alone in the sea.", hint: "(私がひとりで泳ぐことを許す)", options: ["let", "made", "allowed", "had"], answer: "allowed", explanation: "'allow + 人 + to不定詞' の形を使います。他に 'ask/tell/order/advise' などがあります。" },
            { id: '3-7', lesson: 'GS_I-3', text: "We ______ to go to the same school.", hint: "(かつては同じ学校に通っていた)", options: ["used", "are used", "were used", "used to"], answer: "used to", explanation: "'used to 不定詞' で「以前、〜していた」を意味します。" },
            { id: '3-8', lesson: 'GS_I-3', text: "This copy machine ______ work. What's wrong?", hint: "(どうしても作動しない)", options: ["doesn't", "won't", "can't", "isn't"], answer: "won't", explanation: "'won't 動詞' で「どうしても〜しない（してくれない）」を意味します。例: He wouldn't listen to me.（どうしても私の話を聞いてくれなかった。）" },
            { id: '3-9', lesson: 'GS_I-3', text: "I ______ have reported it to the police, but I didn't.", hint: "(そのことを通報するべきだった)", options: ["must", "would", "should", "could"], answer: "should", explanation: "'should have + 過去分詞' で「〜すべきだった」を意味します。" },
            { id: '3-10', lesson: 'GS_I-3', text: "I ______ lunch when the phone rang.", hint: "(ちょうどお昼を食べているところだった)", options: ["ate", "had eaten", "was eating", "have eaten"], answer: "was eating", explanation: "過去の特定の瞬間（'the phone rang'）に進行していた動作なので、過去進行形を使います。" },
            { id: '3-11', lesson: 'GS_I-3', text: "He told me that he ______ his roommate only two weeks before.", hint: "(すでにルームメートに会っていた)", options: ["met", "had met", "has met", "would meet"], answer: "had met", explanation: "'He told me'（過去形）の時よりも以前（2週間前）にルームメートに会っているので、過去完了形 'he had met' になります。" },
            { id: '3-12', lesson: 'GS_I-3', text: "I wonder ______ Jane will come.", hint: "(Jane はいつ来るのだろう)", options: ["if", "that", "when", "how"], answer: "when", explanation: "'主語 + wonder + when + will' を用いた文です。理屈ではなく、感覚で覚えましょう。" },
            { id: '3-13', lesson: 'GS_I-3', text: "I will give him a call when I ______ up tomorrow morning.", hint: "(明日の朝、起きた時点で)", options: ["will get", "get", "got", "am getting"], answer: "get", explanation: "時や条件を表す副詞節の中では、未来のことでも現在形を使います。例: when I get up tomorrow morning, by the time she gets here, before it rains。" },
            { id: '3-14', lesson: 'GS_I-3', text: "By the time she ______ there, it will be nearly dark.", hint: "(彼女がそこに着く頃には)", options: ["will get", "gets", "got", "is getting"], answer: "gets", explanation: "時や条件を表す副詞節の中では、未来のことでも現在形を使います。" },
            { id: '3-15', lesson: 'GS_I-3', text: "Let's go home before it ______.", hint: "(雨が降る前に)", options: ["will rain", "rains", "rained", "is raining"], answer: "rains", explanation: "時や条件を表す副詞節の中では、未来のことでも現在形を使います。" },
            { id: '3-16', lesson: 'GS_I-3', text: "You should take some time off. You ______ too hard lately.", hint: "(最近、一生懸命に働きすぎだよ)", options: ["are working", "worked", "have been working", "had worked"], answer: "have been working", explanation: "「（この頃、一定期間継続して）ずっと〜している」は現在完了進行形を使います。'You are working too hard.' は「（今、最近）〜している」という現在進行形です。" },
            { id: '3-17', lesson: 'GS_I-3', text: "He ______ for two hours when she came in.", hint: "(ずっと(本を)読んでいた)", options: ["was reading", "had read", "had been reading", "has been reading"], answer: "had been reading", explanation: "「（ある一定の時まで）ずっと〜していた」は過去完了進行形を使います。" },
            { id: '3-18', lesson: 'GS_I-3', text: "I ______ my homework by the time my friends come to see me.", hint: "(終わらせているだろう)", options: ["will finish", "will have finished", "have finished", "am finishing"], answer: "will have finished", explanation: "未来の特定の時までに「完了」していることを表現するには未来完了形を使います。例: by the time my friends come to see me, by the end of March。" },
            { id: '3-19', lesson: 'GS_I-3', text: "The snow ______ by the end of March.", hint: "(消えているだろう)", options: ["will disappear", "will have disappeared", "has disappeared", "disappears"], answer: "will have disappeared", explanation: "未来の特定の時までに「完了」していることを表現するには未来完了形を使います。" },
            { id: '3-20', lesson: 'GS_I-3', text: "In the English language, many words ______ letters which are not pronounced.", hint: "(含んでいる)", options: ["contain", "contains", "are containing", "contained"], answer: "contain", explanation: "普遍の事実（いつの時も変わらない事実）は現在形で表します。" },
            { id: '4-1', lesson: 'GS_I-4', text: "On ______ at the train station, I found that the train was being delayed.", hint: "(駅に着くとすぐに)", options: ["arrive", "arrived", "arriving", "to arrive"], answer: "arriving", explanation: "'on -ing' で「〜するとすぐに」を意味します。" },
            { id: '4-2', lesson: 'GS_I-4', text: "He had no difficulty ______ the place.", hint: "(その場所を見つけることにおいて)", options: ["to find", "in finding", "find", "finding"], answer: "in finding", explanation: "'in -ing' で「〜するときに、〜する際に、〜することにおいて」を意味します。" },
            { id: '4-3', lesson: 'GS_I-4', text: "Holmes went out ______ noticed.", hint: "(気づかれることなく)", options: ["without notice", "without being noticed", "not noticed", "without noticing"], answer: "without being noticed", explanation: "'without -ing' で「〜しないで、〜せずに」を意味します。" },
            { id: '4-4', lesson: 'GS_I-4', text: "The traffic jam ______ us from arriving on time.", hint: "(私たちが時間通りに到着することを妨げた)", options: ["stopped", "prevented", "kept", "hindered"], answer: "prevented", explanation: "'prevent + （目的語） + from -ing' で「（目的語）が〜するのを妨げる」を意味します。" },
            { id: '4-5', lesson: 'GS_I-4', text: "______ books, libraries offer various other services.", hint: "(本を貸し出す他に)", options: ["Beside lending", "Besides lending", "Except lending", "In addition lending"], answer: "Besides lending", explanation: "'besides -ing' で「〜のほかに、〜だけでなく」を意味します。" },
            { id: '4-6', lesson: 'GS_I-4', text: "Would you mind ______ an eye on my luggage while I make a phone call?", hint: "(荷物に注意しておいていただけますか)", options: ["keeping", "to keep", "keep", "kept"], answer: "keeping", explanation: "'Would you mind -ing...?' は「〜していただけますか？」という疑問形です。否定形の場合は 'I wouldn't mind sharing this room with you.'（この部屋をあなたと共有するのは気にしない、かまわない）となります。" },
            { id: '4-7', lesson: 'GS_I-4', text: "Would you mind ______ on the sofa?", hint: "(私が) ソファに横になってもよろしいですか?)", options: ["I lying", "me to lie", "my lying", "me lying"], answer: "my lying", explanation: "'Would you mind (one's) -ing...?' は「（one が）〜してもいいですか？」という疑問形です。否定形の場合は 'He wouldn't mind you (your) joining us.'（彼が私たちに加わるのは気にしない、かまわない）となります。" },
            { id: '4-8', lesson: 'GS_I-4', text: "I'm used to ______ on my own.", hint: "(私は自分で料理することには慣れている。)", options: ["cook", "cooking", "cooked", "to cook"], answer: "cooking", explanation: "'be used to -ing' または 'be accustomed to -ing / get used to -ing' で「〜することに慣れている」を意味します。例: I'm accustomed to handling the crazy claims from customers.（顧客からのクレームに対応することに慣れている）" },
            { id: '4-9', lesson: 'GS_I-4', text: "I'm really ______ there again sometime.", hint: "(そこにもう一度行くことを楽しみにしている)", options: ["looking forward to go", "looking forward to going", "look forward to go", "look forward to going"], answer: "looking forward to going", explanation: "'look forward to -ing' で「〜することを楽しみにしている」を意味します。" },
            { id: '4-10', lesson: 'GS_I-4', text: "I object to ______ like that.", hint: "(そういう扱いを受けることに反発する)", options: ["be treated", "treating", "being treated", "to be treated"], answer: "being treated", explanation: "'object to -ing' で「〜することに反対する」を意味します。例: My parents objected to my going abroad to study.（両親は私が留学することに反対した）" },
            { id: '4-11', lesson: 'GS_I-4', text: "My mother has made me ______ today.", hint: "(私が何者であるか)", options: ["what I am", "who I am", "what I was", "who I was"], answer: "what I am", explanation: "'what + 目的語 + be動詞' で「私が何者であるか」を意味します。例: He has changed a lot, and he is not what he was.（彼は大きく変わって、以前の彼ではない）" },
            { id: '4-12', lesson: 'GS_I-4', text: "What I can't understand is ______ you have changed your mind.", hint: "(なぜあなたが自分の考えを変えたのかだ)", options: ["that", "how", "why", "what"], answer: "why", explanation: "'Why + S + V' で「なぜS+Vなのか」を意味します。" },
            { id: '4-13', lesson: 'GS_I-4', text: "Listen carefully to ______ the teacher tells you.", hint: "(先生があなたに何を伝えるのか)", options: ["that", "what", "which", "how"], answer: "what", explanation: "'what + S' + V' の形を使います。" },
            { id: '4-14', lesson: 'GS_I-4', text: "He was the only student ______ solved the problem.", hint: "(その問題を解いた唯一の学生だった)", options: ["who", "which", "that", "whom"], answer: "that", explanation: "'the only S' that V'' の形を使います。'only, the same, the very, all, any, no' などを伴う場合には 'that' を使うのが通例です。" },
            { id: '4-15', lesson: 'GS_I-4', text: "That is ______ he got out of danger.", hint: "(どのように彼が危機を脱したのか)", options: ["what", "which", "how", "why"], answer: "how", explanation: "'how S + V' で「どのようにSがVしたのか」を意味します。" },
            { id: '4-16', lesson: 'GS_I-4', text: "This is ______ I raised this question again.", hint: "(なぜ、もう一度、質問をしたのか)", options: ["how", "what", "why", "that"], answer: "why", explanation: "'why S + V' で「なぜSがVしたのか」を意味します。" },
            { id: '5-1', lesson: 'GS_I-5', text: "There is no need ______ for you to wait for me.", hint: "(あなたは私のために待つ必要はない。)", options: ["to", "that", "for", "of"], answer: "for", explanation: "'There is no need for... to~' で「...が〜する必要はない」を意味します。" },
            { id: '5-2', lesson: 'GS_I-5', text: "We ______ to come across each other at the station.", hint: "(私たちはたまたま駅で会った。)", options: ["happened", "managed", "chanced", "occurred"], answer: "happened", explanation: "'We happened to~' で「私たちはたまたま〜した」を意味します。" },
            { id: '5-3', lesson: 'GS_I-5', text: "The circumstances seem ______ no way out.", hint: "(全く出口を示してはいないようだ)", options: ["to indicate", "indicating", "to be indicated", "indicate"], answer: "to indicate", explanation: "'seem to~' で「〜であるようだ」を意味します。'It seems that the circumstances indicate no way out.' とも言えます。" },
            { id: '5-4', lesson: 'GS_I-5', text: "My friend seems ______ the trip.", hint: "(旅行を楽しんだようだ)", options: ["to enjoy", "to have enjoyed", "enjoying", "enjoyed"], answer: "to have enjoyed", explanation: "'seem to~' で「〜であるようだ」を意味します。'It seems that my friend have enjoyed the trip.' とも言えます。" },
            { id: '5-5', lesson: 'GS_I-5', text: "He is said ______ up in the US.", hint: "(彼はアメリカで育てられたと言われている。)", options: ["to bring", "to have brought", "to be brought", "to have been brought"], answer: "to have been brought", explanation: "'be said to have -ed' で「〜したと言われている」を意味します。時制を 'be said' に合わせるために 'to have -ed'（現在完了形）の形になります。'It is said that he has been brought up in the US.' とも言えます。" },
            { id: '5-6', lesson: 'GS_I-5', text: "She is believed ______ the crime.", hint: "(彼女は罪を犯したと思われている。)", options: ["to commit", "to have committed", "to be committed", "to have been committed"], answer: "to have committed", explanation: "'be believed to have -ed' で「〜したと思われて（信じられて）いる」を意味します。時制を 'be believed' に合わせるために 'to have -ed'（現在完了形）の形になります。'It is believed that she has committed the crime.' とも言えます。" },
            { id: '5-7', lesson: 'GS_I-5', text: "Be sure ______ all the belongings with you when you leave.", hint: "(忘れ物のないようにご注意ください)", options: ["take", "to take", "taking", "taken"], answer: "to take", explanation: "'Be sure to~' で「〜するのを忘れないようにしなさい」を意味します。" },
            { id: '5-8', lesson: 'GS_I-5', text: "The price of gasoline is likely ______ up again.", hint: "(上がるようだ)", options: ["go", "going", "to go", "gone"], answer: "to go", explanation: "'be likely to~' で「〜しそうだ」を意味します。'It is likely that the price of gasoline will go up again.' とも言えます。" },
            { id: '5-9', lesson: 'GS_I-5', text: "The game is supposed ______ at six o'clock sharp.", hint: "(ちょうど6時に始まるはずだ)", options: ["start", "to start", "starting", "started"], answer: "to start", explanation: "'be supposed to~' で「〜するはずだ」を意味します。" },
            { id: '5-10', lesson: 'GS_I-5', text: "It was easy ______ the passwords.", hint: "(パスワードを考えつくのは簡単だった)", options: ["figure out", "to figure out", "figuring out", "figured out"], answer: "to figure out", explanation: "'It is easy to~' で「〜することは簡単だ」を意味します。'figure out' は「考えつく」です。" },
            { id: '5-11', lesson: 'GS_I-5', text: "A hot climate is difficult ______ to.", hint: "(慣れるのは難しい)", options: ["to become accustomed", "to accustom", "to be accustomed", "be accustomed"], answer: "to become accustomed", explanation: "'-be動詞 + 形容詞 + to~' で「〜は〜するのが形容詞だ」を意味します。'It is difficult to become accustomed to a hot climate.' の方が分かりやすい文型です。" },
            { id: '5-12', lesson: 'GS_I-5', text: "The man helped me ______ for my keys.", hint: "(鍵を探すのを助けてくれた)", options: ["look", "to look", "looking", "looked"], answer: "look", explanation: "'help + ... + 原形動詞' で「...が原形するのを助ける」を意味します。" },
            { id: '5-13', lesson: 'GS_I-5', text: "The teacher had students ______ the sentence five times.", hint: "(生徒に繰り返させた)", options: ["repeat", "to repeat", "repeating", "repeated"], answer: "repeat", explanation: "'have + ... + 原形動詞' で「...に〜させる」を意味します。" },
            { id: '5-14', lesson: 'GS_I-5', text: "The team made him ______ the contract before he changed his mind.", hint: "(彼に署名させた)", options: ["sign", "to sign", "signing", "signed"], answer: "sign", explanation: "'make + ... + 原形動詞' で「...に〜させる」を意味します。" },
            { id: '5-15', lesson: 'GS_I-5', text: "Please let me ______ how it goes.", hint: "(私に知らせてください)", options: ["know", "to know", "knowing", "known"], answer: "know", explanation: "'let + ... + 原形動詞' で「...に〜させる」を意味します。" },
            { id: '5-16', lesson: 'GS_I-5', text: "It was so quiet that you could hear a pin ______.", hint: "(ピンが落ちる音さえ聞こえるくらい)", options: ["drop", "to drop", "dropping", "dropped"], answer: "drop", explanation: "'hear + ... + 原形動詞' で「...が〜するのが聞こえる」を意味します。'hear + A + -ing' は「Aが〜しているのを聞く」です。例: I've never heard him speaking English.（彼が英語を話すのを聞いたことがない）" },
            { id: '5-17', lesson: 'GS_I-5', text: "You need to tell her ______ to go.", hint: "(どこに行くべきなのか)", options: ["what", "which", "where", "how"], answer: "where", explanation: "'where to~' で「どこに〜するべきか」を意味します。" },
            { id: '5-18', lesson: 'GS_I-5', text: "I don't know ______ to express my apology.", hint: "(どのように表現するべきか)", options: ["what", "which", "where", "how"], answer: "how", explanation: "'how to~' で「どのように〜するべきか」を意味します。" },
            { id: '5-19', lesson: 'GS_I-5', text: "We are ______ up at the station and start heading for Mt. Takao.", hint: "(駅で待ち合わせて、高尾山に向かうはずなのだ)", options: ["meet", "to meet", "meeting", "met"], answer: "to meet", explanation: "'be動詞 + to~' で「〜するべきである、〜するはずである」を意味します。" },
            { id: '5-20', lesson: 'GS_I-5', text: "To make matters ______, I forgot my smartphone in the train.", hint: "(さらに悪いことに)", options: ["bad", "worse", "worst", "badly"], answer: "worse", explanation: "'To make matters worse' で「さらに悪いことには」を意味します。" },
            { id: '6-1', lesson: 'GS_I-6', text: "I have just ______ to the supermarket to get some milk.", hint: "(たった今、スーパーに行ってきたところ)", options: ["gone", "been", "went", "go"], answer: "been", explanation: "'just' は 'have' と 'been' の間に入り、「たった今、〜してきた」を意味します。" },
            { id: '6-2', lesson: 'GS_I-6', text: "My sister has lived in the US ______ ten years.", hint: "(10年以上ものあいだ)", options: ["over", "more than", "for more than", "since more than"], answer: "for more than", explanation: "'for more than' で「〜以上ものあいだ」を意味します。" },
            { id: '6-3', lesson: 'GS_I-6', text: "The bakery has been open ______ a week, and look how popular it is!", hint: "(開店してからまだ1週間も経っていないのに)", options: ["for no more than", "no more than", "not more than", "less than"], answer: "for no more than", explanation: "'〜（現在完了） for no more than ...' で「〜してから... も経っていない」を意味します。" },
            { id: '6-4', lesson: 'GS_I-6', text: "My brother has been feeling low ______ the past few weeks.", hint: "(この何週間か)", options: ["since", "for", "in", "during"], answer: "for", explanation: "'for the past...' で「この（過去）...くらい」を意味します。例: for the past few days, for the past few decades など。" },
            { id: '6-5', lesson: 'GS_I-6', text: "It has been about two months ______ I started studying at this university.", hint: "(この大学で勉強し始めてから約2か月が経った)", options: ["when", "that", "since", "after"], answer: "since", explanation: "'It has been ... since~' で「〜してから...の時間が経った」を意味します。'About two months have passed since I started studying at this university.' とも言えます。" },
            { id: '6-6', lesson: 'GS_I-6', text: "It will be more than three years ______ I graduate from university and start working.", hint: "(大学を卒業して働きだすまで、あと3年以上ある)", options: ["until", "before", "when", "by the time"], answer: "before", explanation: "'It will be... before~' で「〜するまで...の時間がある」を意味します。" },
            { id: '6-7', lesson: 'GS_I-6', text: "It was not long ______ the waitress came back with a new glass of water.", hint: "(ウエイトレスが戻ってくるまであまり時間がかからなかった)", options: ["when", "until", "before", "that"], answer: "before", explanation: "'It was not long before S + V' で「SがVするまでそれほど時間がかからなかった」を意味します。" },
            { id: '6-8', lesson: 'GS_I-6', text: "The ______ I entered the classroom, I knew something was wrong.", hint: "(私が)教室に入ってすぐに)", options: ["time", "moment", "instant", "soon"], answer: "moment", explanation: "'The moment S + V' で「SがVするとすぐに」を意味します。" },
            { id: '6-9', lesson: 'GS_I-6', text: "It was not until you pointed out my mistake ______ I recognized it.", hint: "(あなたが私の間違いを指摘するまで、私はそれに気付かなかった)", options: ["when", "that", "which", "where"], answer: "that", explanation: "'It was not until ~ that...' で「〜まで...しなかった」を意味します。" },
            { id: '6-10', lesson: 'GS_I-6', text: "______ she sings on a stage, it is as if she is making a prayer.", hint: "(彼女が歌を歌うたびに)", options: ["Whenever", "Every time", "Each time", "As soon as"], answer: "Every time", explanation: "'Every time S + V' で「SがVするたびに」を意味します。" },
            { id: '6-11', lesson: 'GS_I-6', text: "______ he makes up his mind, he never changes it.", hint: "(一度決断をすると)", options: ["If", "When", "Once", "As"], answer: "Once", explanation: "'Once S + V' で「一度、SがVすると」を意味します。" },
            { id: '6-12', lesson: 'GS_I-6', text: "The legendary singer is holding a concert ______ fifteen years.", hint: "(15年ぶりに)", options: ["for the first time in", "for first time in", "the first time in", "in the first time of"], answer: "for the first time in", explanation: "'for the first time in~' で「〜ぶりに」を意味します。例: for the first time in ten days, for the first time in decades など。" },
            { id: '6-13', lesson: 'GS_I-6', text: "There are ______ books or references in this area.", hint: "(この分野については、本や資料がほとんどない)", options: ["few", "little", "hardly any", "not many"], answer: "hardly any", explanation: "'There is/are hardly any ...' で「...はほとんどない」を意味します。'...' の部分が単数形名詞や不可算名詞であれば 'is'、複数形名詞であれば 'are' を使うと良いでしょう。" },
            { id: '6-14', lesson: 'GS_I-6', text: "What you are saying is not wrong, but ______ of us approve of it.", hint: "(我々の全ての人間が認めているわけではない)", options: ["all", "not all", "none", "every"], answer: "not all", explanation: "'not all of ...' で「必ずしも全ての...が〜しているわけではない」を意味します。'not all' は複数扱い（x not all of us approves）です。" },
            { id: '6-15', lesson: 'GS_I-6', text: "______ of the candidates was qualified for the job.", hint: "(どの候補もその仕事に充分な能力がなかった)", options: ["All", "None", "Neither", "Every"], answer: "None", explanation: "'None of ...' で「...のうちのどれも〜していなかった」を意味します。'none of ...' は単数扱い（x None of the candidates were）です。" },
            { id: '6-16', lesson: 'GS_I-6', text: "Not only my keys but also my smartphone ______ missing.", hint: "(鍵だけでなくスマートフォンまでなくなっていた)", options: ["were", "are", "was", "is"], answer: "was", explanation: "'Not only A but also B' では、動詞はBに従う形になります。例: Not only he but also I am coming to see you." },
            { id: '7-1', lesson: 'GS_I-7', text: "The young woman ______ in the corner is Mary Smith.", hint: "(すみに立っている若い女性)", options: ["stand", "standing", "stood", "to stand"], answer: "standing", explanation: "'A（名詞） + -ing' で「〜しているA」を意味します。" },
            { id: '7-2', lesson: 'GS_I-7', text: "There is three thousand dollars ______ in my back account.", hint: "(3000 ドル残っている)", options: ["left", "leaving", "to leave", "leaves"], answer: "left", explanation: "'There is -ed (または -ing)' で「〜が〜された（〜している）状態になっている」を意味します。例: There is some chicken frozen in the refrigerator.（冷蔵庫に鶏肉が凍っている）, There are some people waiting in the other room.（別の部屋で何人かの人が待っている）。" },
            { id: '7-3', lesson: 'GS_I-7', text: "I was very ______ to meet a famous actress at the party.", hint: "(とても興奮した)", options: ["exciting", "excited", "excite", "to excite"], answer: "excited", explanation: "人が主語の場合は 'be excited'、ものが主語の場合は 'be exciting' です。例: surprised, disappointed, interested, tired。" },
            { id: '7-4', lesson: 'GS_I-7', text: "He seemed ______ at the news.", hint: "(彼はニュースに驚いたように見えた。)", options: ["surprising", "surprised", "to surprise", "surprise"], answer: "surprised", explanation: "'seem' の時も、人が主語の場合は 'seem surprised'、ものが主語の場合は 'seem surprising' です。例: shocked, pleased, seem disappointed。" },
            { id: '7-5', lesson: 'GS_I-7', text: "I make it a rule to go ______ before breakfast.", hint: "(ジョギングに行く)", options: ["jog", "to jog", "jogging", "jogged"], answer: "jogging", explanation: "'go -ing' で「〜しに行く」を意味します。例: go shopping, go swimming, go skiing。" },
            { id: '7-6', lesson: 'GS_I-7', text: "Where did he have his car ______?", hint: "(彼はどこで車を修理してもらったのですか?)", options: ["repair", "to repair", "repairing", "repaired"], answer: "repaired", explanation: "'have + A + -ed' で「Aを〜してもらう」を意味します。" },
            { id: '7-7', lesson: 'GS_I-7', text: "I have to get my ticket ______ since I bought a wrong one.", hint: "(チケットを変えてもらう)", options: ["change", "to change", "changing", "changed"], answer: "changed", explanation: "'get + A + -ed' で「Aを〜してもらう」を意味します。" },
            { id: '7-8', lesson: 'GS_I-7', text: "______ his coat off, he set to work.", hint: "(コートを脱いで)", options: ["Took", "Taking", "To take", "Having taken"], answer: "Taking", explanation: "「AをしてからBした」という順序を表す場合、Aの動詞を -ing 形にして文頭に置きます（分詞構文）。例: He took off his coat, and he set to work.（彼はコートを脱いで、仕事にとりかかった）" },
            { id: '7-9', lesson: 'GS_I-7', text: "______ my breakfast, I got ready to leave for school.", hint: "(朝食を食べたあとで(朝食を食べ終わったので))", options: ["Eating", "Having eaten", "To eat", "Eaten"], answer: "Having eaten", explanation: "完了を表す分詞構文です。完了形を作る 'have' を 'having' にして文頭に置きます。'After I had eaten my breakfast,...' とも言えます。" },
            { id: '7-10', lesson: 'GS_I-7', text: "______ read the book, I cannot tell whether it is worth reading.", hint: "(その本を読んでいないので)", options: ["Not reading", "Not having", "Not having read", "Having not read"], answer: "Not having read", explanation: "否定の分詞構文では、'Not' を文頭に置きます。" },
            { id: '7-11', lesson: 'GS_I-7', text: "Everyone ______ very busy, the meeting was hurriedly finished.", hint: "(みんながとても忙しかったので)", options: ["is", "was", "being", "been"], answer: "being", explanation: "「、」の前後で主語が異なる場合、前半（理由の部分）の動詞を -ing 形にします。'Everyone was very busy.' だから 'The meeting was hurriedly finished.' となります。" },
            { id: '7-12', lesson: 'GS_I-7', text: "______ in the leg, Henry could hardly walk.", hint: "(脚を負傷したので、)", options: ["Wound", "Wounding", "Wounded", "Being wounded"], answer: "Wounded", explanation: "'(Being) wounded in the leg' となり、'Being' が省略されています。" },
            { id: '7-13', lesson: 'GS_I-7', text: "I felt so ______ after a swim in the pool.", hint: "(とても興奮した)", options: ["refreshing", "refreshed", "to refresh", "refresh"], answer: "refreshed", explanation: "'feel -ed' で「〜された気分にある」を意味します。例: feel neglected（ネグレクトされた気分になる）, feel energized（エネルギーチャージされた気分になる）。" },
            { id: '7-14', lesson: 'GS_I-7', text: "Kate speaks English very fast. I've never heard English ______ so quickly.", hint: "(英語がそんなに速く話されるのを聞いたことがない。)", options: ["speak", "to speak", "speaking", "spoken"], answer: "spoken", explanation: "'hear + A + -ed' で「Aが〜されるのが聞こえる」を意味します。'hear + A + -ing' は「Aが〜しているのを聞く」です。例: I've never heard him speaking English.（彼が英語を話すのを聞いたことがない）" },
            { id: '7-15', lesson: 'GS_I-7', text: "The manager kept me ______ outside his office.", hint: "(私を待たせた)", options: ["wait", "to wait", "waiting", "waited"], answer: "waiting", explanation: "'keep + ... + -ing' で「...を〜している状態にする」を意味します。" },
            { id: '7-16', lesson: 'GS_I-7', text: "I kept my dog ______ to a tree in the garden.", hint: "(犬を(庭の木に) つながれた状態にしておいた)", options: ["tie", "to tie", "tying", "tied"], answer: "tied", explanation: "'keep + ... + -ed' で「...を〜された状態にする」を意味します。" },
            { id: '7-17', lesson: "GS_I-7", text: "I want this luggage ______ to my room at once.", hint: "(荷物を(私の部屋に) 運ばれて欲しい)", options: ["take", "to take", "taking", "taken"], answer: "taken", explanation: "'want + A + -ed' で「Aが〜されて欲しい（〜された状態になって欲しい）」を意味します。" },
            { id: '7-18', lesson: 'GS_I-7', text: "It is not a good idea to spend your time ______ TV.", hint: "(TVを見ながら (時間を過ごす))", options: ["watch", "to watch", "watching", "watched"], answer: "watching", explanation: "'spend A -ing' で「〜しながらAを過ごす」を意味します。例: I spent last three hours doing my homework.（私はこの3時間、宿題をしながら過ごした）" },
            { id: '8-1', lesson: 'GS_I-8', text: "If I ______ you, I wouldn't buy that car.", hint: "(もし私があなたなら、私はその車を買わない。)", options: ["am", "was", "were", "would be"], answer: "were", explanation: "「仮定法過去」は現在の事実と反対のことを仮定するときに使います。" },
            { id: '8-2', lesson: 'GS_I-8', text: "He probably wouldn't act that way if he ______ in Japan.", hint: "(もし彼が日本にいたら、彼はたぶん、そんな行動はとらないだろう。)", options: ["is", "was", "were", "had been"], answer: "were", explanation: "「仮定法過去」です。" },
            { id: '8-3', lesson: 'GS_I-8', text: "If I ______ to go abroad, I would go to France.", hint: "(もし私が海外に行くとしたら、私はフランスに行きたい。)", options: ["am", "was", "were", "should"], answer: "were", explanation: "'were to... would...' は実現する可能性が少ないことについての仮定するときに使います。" },
            { id: '8-4', lesson: 'GS_I-8', text: "If I ______ known that film was on last week, I would have seen it.", hint: "(もし先週、あの映画が上映されていると(私が) 知っていたら、私は見に行っただろう。)", options: ["have", "had", "would have", "should have"], answer: "had", explanation: "「仮定法過去完了」は過去の事実（起きてしまったこと）と反対の仮定を表すときに使います。'If S had -ed, S would [should/could/might] have -ed.' で「もし〜だったら、〜していただろう」です。" },
            { id: '8-5', lesson: 'GS_I-8', text: "If I ______ enough time, I could have gone to Okinawa on vacation.", hint: "(もし私が十分な時間があったなら、休暇で沖縄に行けただろう。)", options: ["had", "had had", "have had", "would have had"], answer: "had had", explanation: "「仮定法過去完了」です。" },
            { id: '8-6', lesson: 'GS_I-8', text: "Mary would have gone to the party, if she ______ an invitation.", hint: "(もしメアリーが招待状を持っていたのなら、彼女はパーティーに行っただろう。)", options: ["had", "had had", "has", "would have had"], answer: "had had", explanation: "「仮定法過去完了」です。" },
            { id: '8-7', lesson: 'GS_I-8', text: "If I ______ not been ill, I could have attended the meeting.", hint: "(もし私が病気でなかったら、その会議に出席できただろう。)", options: ["was", "were", "had", "had not"], answer: "had not", explanation: "「仮定法過去完了」です。" },
            { id: '8-8', lesson: 'GS_I-8', text: "If you ______ my advice, you wouldn't be in this situation now.", hint: "(もしあなたが私のアドバイスを聞いていたら、今頃、このような状況にはなっていなかった。)", options: ["took", "had taken", "would take", "would have taken"], answer: "had taken", explanation: "「仮定法過去完了」と「仮定法過去」の混合文です。「もし、あの時に〜していたら（仮定法過去完了）、今頃〜なのだろう（仮定法過去）」という形です。" },
            { id: '8-9', lesson: 'GS_I-8', text: "I wish I ______ Spanish as well as you.", hint: "(あなたと同じくらい上手にスペイン語が話せたらいいのに。)", options: ["can speak", "could speak", "will speak", "speak"], answer: "could speak", explanation: "「仮定法過去」です。（今、話せない。話せるようになりたいという願望）" },
            { id: '8-10', lesson: 'GS_I-8', text: "I wish I ______ there with you.", hint: "(そこにあなたと一緒にいたら(いられたのなら)よかったのに。)", options: ["am", "was", "had been", "have been"], answer: "had been", explanation: "「仮定法過去完了」です。（過去に一緒にいなかった。いてあげられたらよかった...と今思っている）" },
            { id: '8-11', lesson: 'GS_I-8', text: "It is time you ______ back to work.", hint: "(そろそろ仕事に戻るべき時間だ。)", options: ["get", "got", "will get", "should get"], answer: "got", explanation: "'It is time S 過去形' で「そろそろ〜するべき時だ」を意味します。'You had better get back to work.' とも言えます。" },
            { id: '8-12', lesson: 'GS_I-8', text: "I was very tired. ______ I would have gone to the party with you last night.", hint: "(そうでなければ、私は昨夜、あなたとパーティーに行っただろう。)", options: ["Otherwise", "However", "Therefore", "Moreover"], answer: "Otherwise", explanation: "'Otherwise' で「さもなければ、そうでなければ」を意味します。" },
            { id: '8-13', lesson: 'GS_I-8', text: "It was you who suggested that I ______ the truth.", hint: "(彼に本当のことを伝えるべきだと提案したのはあなただった。)", options: ["tell", "told", "should tell", "telling"], answer: "tell", explanation: "'suggest that S + (should) 動詞の原形' の形を使います。他に 'propose/demand/request/order/insist' などがあります。" },
            { id: '8-14', lesson: 'GS_I-8', text: "The woman demanded that she ______ a refund.", hint: "(その女性は払い戻しがされるように要求した。)", options: ["is given", "be given", "was given", "to be given"], answer: "be given", explanation: "前の問題と同様に 'demand that S + (should) 動詞の原形' の形を使いますが、ここでは受動態になっています。" },
            { id: '8-15', lesson: 'GS_I-8', text: "I proposed that we ______ home early today.", hint: "(私は今日は早く家に帰ろうと提案した。)", options: ["go", "went", "should go", "going"], answer: "go", explanation: "前の問題と同様に 'propose that S + (should) 動詞の原形' の形を使います。" },
            { id: '9-1', lesson: 'GS_I-9', text: "You are ______ to gain weight in summer than in winter.", hint: "(冬よりも夏の方が、体重が増える傾向が少ない。)", options: ["less likely", "more likely", "likely", "least likely"], answer: "less likely", explanation: "'be less likely to~' で「〜する傾向が少ない（〜しにくい）」を意味します。比較級なので 'than' で比較対象を示します。" },
            { id: '9-2', lesson: 'GS_I-9', text: "She is ______ gentle than kind.", hint: "(「親切」というよりは「やさしい」。)", options: ["kind", "more", "most", "less"], answer: "more", explanation: "'more A than B' で「BというよりはAだ」を意味します。" },
            { id: '9-3', lesson: 'GS_I-9', text: "The ______ half of the program was interesting.", hint: "(プログラムの後半半分は)", options: ["later", "last", "latter", "latest"], answer: "latter", explanation: "'latter half' で「後半半分」を意味します。" },
            { id: '9-4', lesson: 'GS_I-9', text: "This report is ______ better than the previous one.", hint: "(前回のそれよりもずっといい)", options: ["very", "much", "so", "quite"], answer: "much", explanation: "比較級を強調する際には 'much' を使います。" },
            { id: '9-5', lesson: 'GS_I-9', text: "He is ______ the cleverest student in the class.", hint: "(彼はクラスのなかでもとびぬけていちばん頭がいい。)", options: ["by far", "very", "much", "so"], answer: "by far", explanation: "'by far' で「ずば抜けて、大差で」を意味します。" },
            { id: '9-6', lesson: 'GS_I-9', text: "Please take ______ cookies as you like.", hint: "(好きなだけクッキーを取ってください。)", options: ["as much", "as many", "so much", "so many"], answer: "as many", explanation: "'as many/much ~ as you like' で「好きなだけ〜」を意味します。cookiesは可算名詞なので 'many' を使います。" },
            { id: '9-7', lesson: 'GS_I-9', text: "He has ______ times as many sneakers as I have.", hint: "(彼は私の3倍の数のスニーカーを持っている。)", options: ["two", "three", "four", "many"], answer: "three", explanation: "'数字 + times as many/much ~ as...' で「〜の何倍」を意味します。'He has three times the number of sneakers that I have.' とも言えます。" },
            { id: '9-8', lesson: 'GS_I-9', text: "Our house is ______ the size of yours.", hint: "(私たちの家はあなたの家の2倍の大きさだ。)", options: ["twice", "double", "two times", "twofold"], answer: "twice", explanation: "'twice the size of~' で「〜の2倍の大きさ」を意味します。'Our house is twice as large as yours.' とも言えます。" },
            { id: '9-9', lesson: 'GS_I-9', text: "It used to take me ______ times as much time to do the same job.", hint: "(かつて、同じ仕事をするのに、今の3倍の時間がかかっていた。)", options: ["two", "three", "four", "many"], answer: "three", explanation: "'数字 + times as much time (as it does now) to do~' で「〜するのに何倍の時間がかかる」を意味します。" },
            { id: '9-10', lesson: 'GS_I-9', text: "We were ______ delighted because we had not expected it.", hint: "(私たちは期待していなかったので、余計にいっそう喜んだ。)", options: ["more", "the more", "all the more", "even more"], answer: "all the more", explanation: "'be all the more because...' で「...なので余計にいっそう〜だった」を意味します。" },
            { id: '9-11', lesson: 'GS_I-9', text: "The Amazon is the ______ longest river in the world after the Nile.", hint: "(アマゾン川はナイル川に次いで世界で2番目に長い川だ。)", options: ["one-second", "second", "two", "secondly"], answer: "second", explanation: "'the 序数詞（ex. first, second, third） + 最上級' の形を使います。'after the Nile' で「〜に次いで」を意味します。" },
            { id: '9-12', lesson: 'GS_I-9', text: "This is the ______ tree that I have ever seen.", hint: "(これは私が今まで見たなかで一番高い木だ。)", options: ["tall", "taller", "tallest", "most tall"], answer: "tallest", explanation: "「これまで〜したなかで一番〜なもの」は 'the 最上級 that I have ever seen' の形を使います。" },
            { id: '9-13', lesson: 'GS_I-9', text: "I have never heard a more ______ story than this.", hint: "(私はこれまで、これ以上にワクワクする話を聞いたことがない。)", options: ["exciting", "excited", "excite", "excitement"], answer: "exciting", explanation: "'a more 形容詞 名詞 than~' で「〜以上に〜なものをしたことがない」を意味します。" },
            { id: '9-14', lesson: 'GS_I-9', text: "I think that no other job is ______ dangerous than a cab driver in New York City.", hint: "(New York City で運転手をするほど危ない仕事は他にはない)", options: ["most", "more", "much", "very"], answer: "more", explanation: "'no other ~ is more ... than ---' で「---ほど〜な...は他にはない」を意味します。" },
            { id: '9-15', lesson: 'GS_I-9', text: "The ______ he heard about it, the ______ he got.", hint: "(彼はそれを聞けば聞くほど、より興味を持っていった。)", options: ["more / more interested", "most / most interested", "much / much interested", "more / interested"], answer: "more / more interested", explanation: "'The more S + V, the more S' + V'' で「SがVすればするほど、よりSはVしていった」を意味します。" },
            { id: '10-1', lesson: 'GS_I-10', text: "It all depends on ______ they will support us.", hint: "(すべては彼らが援助してくれるのかによる。)", options: ["if", "that", "whether", "what"], answer: "whether", explanation: "「〜かどうか」は 'whether' を使います。（'if' では言い換えられない場合があるので注意！）" },
            { id: '10-2', lesson: 'GS_I-10', text: "We do not appreciate our health ______ we get sick.", hint: "(病気になるまで)", options: ["until", "before", "when", "after"], answer: "until", explanation: "'not until S + V' で「S+Vまで〜しない」または「S+Vしてはじめて〜する」を意味します。" },
            { id: '10-3', lesson: 'GS_I-10', text: "______ I was staying in London, I had a chance to visit the National Gallery.", hint: "(ロンドンに滞在中、ナショナルギャラリーを訪れる機会があった。)", options: ["During", "While", "For", "As"], answer: "While", explanation: "'while' の後ろは 'S+V' です。'During my stay in London, I had a chance to visit the National Gallery.' のように 'during' の後ろは名詞/名詞句です。" },
            { id: '10-4', lesson: 'GS_I-10', text: "We should not keep dogs ______ we can take good care of them.", hint: "(しっかりと面倒を見られなければ)", options: ["if", "unless", "provided", "as long as"], answer: "unless", explanation: "'unless' で「もし〜でなければ、〜でない限り」を意味します。" },
            { id: '10-5', lesson: 'GS_I-10', text: "The children had all gone to sleep ______ it got dark.", hint: "(まだ暗くなる前に)", options: ["until", "by the time", "before", "when"], answer: "before", explanation: "'before' で「〜の前に、〜にならないうちに」を意味します。（'before' に否定の要素があります）" },
            { id: '10-6', lesson: 'GS_I-10', text: "______ you are a university school student, you ought to know better.", hint: "(もう大学生なのだから)", options: ["As", "Since", "Now that", "Because"], answer: "Now that", explanation: "'Now that~' で「もう〜なのだから」を意味します。" },
            { id: '10-7', lesson: 'GS_I-10', text: "We are different from animals ______ we have language.", hint: "(我々は言語を持つという点で)", options: ["because", "in that", "so that", "as if"], answer: "in that", explanation: "'in that~' で「〜という点で、〜だから」を意味します。（'because' と同じ意味です）" },
            { id: '10-8', lesson: 'GS_I-10', text: "I know nothing about her ______ she is a pianist.", hint: "(彼女がピアニストであること以外は)", options: ["except", "except for", "except that", "besides"], answer: "except that", explanation: "'except that~' で「〜ということ以外は」を意味します。'I know nothing about her except for the fact that she is a pianist.' とも言えます。" },
            { id: '10-9', lesson: 'GS_I-10', text: "Leave the letters ______ until he comes back.", hint: "(そのままの状態で)", options: ["as they are", "as is", "as it is", "as they were"], answer: "as they are", explanation: "'as~' で「〜の通りに」を意味します。例: as you wish, as you know。" },
            { id: '10-10', lesson: 'GS_I-10', text: "Eliza was cleaning the cupboards ______ her husband was doing the dishes.", hint: "(Eliza は食器棚を掃除していたが、一方で夫は食器を洗っていた。)", options: ["during", "while", "when", "as"], answer: "while", explanation: "'A while B' で「Bのあいだ、A」を意味します。'while' 前後の順番に注意が必要です。" },
            { id: '10-11', lesson: 'GS_I-10', text: "I can do the job for you ______ I get paid in advance.", hint: "(前払いで払ってもらえるという前提であれば)", options: ["if", "on condition that", "provided", "as long as"], answer: "on condition that", explanation: "'on condition that~' で「〜という前提で、〜という条件で」を意味します。'if' で言い換えられるのは 'asked him if...' や 'I wonder if it will...' のような動詞の場合です。" },
            { id: '10-12', lesson: 'GS_I-10', text: "You may borrow as many books as you like, ______ you return them in a week.", hint: "(一週間で返却するという前提であれば)", options: ["if", "on condition that", "provided that", "as long as"], answer: "provided that", explanation: "'provided that~' で「〜という前提で、〜という条件で」を意味します。" },
            { id: '10-13', lesson: 'GS_I-10', text: "I wonder ______ he will arrive on time.", hint: "(彼は時間通りに到着するのかな)", options: ["if", "that", "whether", "how"], answer: "whether", explanation: "'wonder whether S will 動詞' で「Sが動詞するかしら、と思う」を意味します。" },
            { id: '10-14', lesson: 'GS_I-10', text: "Why do you want a new job ______ you've got such a good one already?", hint: "(すでにそんなによい仕事をしているのにも関わらず、なぜ新しい仕事が欲しいのか?)", options: ["if", "though", "when", "as"], answer: "when", explanation: "'when~' で「〜なのに」を意味します。" },
            { id: '10-15', lesson: 'GS_I-10', text: "I'll have returned to Japan ______ this letter reaches you.", hint: "(この手紙があなたに届くころには)", options: ["until", "by the time", "before", "when"], answer: "by the time", explanation: "'by the time~' で「〜のころには」を意味します。" },
            { id: '10-16', lesson: 'GS_I-10', text: "______ we have no money, we can't buy it.", hint: "(お金がないので)", options: ["As", "Since", "Because", "For"], answer: "Since", explanation: "'since~' で「〜なので」を意味します。" },
            { id: '10-17', lesson: 'GS_I-10', text: "______ I understand what you say, I can't agree with you.", hint: "(あなたの言うことは理解できるけれど、それに同意はできない)", options: ["As", "Since", "While", "Because"], answer: "While", explanation: "'while A, B' で「Aの一方でB」を意味します。'while' 前後の順番に注意が必要です。" },
            { id: '10-18', lesson: 'GS_I-10', text: "The news ______ the famous cathedral was burned down was a great shock to the townspeople.", hint: "(有名な大聖堂が燃え落ちてしまったというニュースは)", options: ["what", "which", "that", "how"], answer: "that", explanation: "'the news that S + V' で「S+Vというニュース」を意味します。例: the fact that S+V, the report that S+V, the belief that S+V, the thought that S+V など。" },
        ];

        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let incorrectQuestionIds = [];
        let sessionIncorrectQuestionIds = [];
        let answeredQuestions = new Set();
        let currentMode = 'random-10';
        let questionCount = 10;
        let showProgress = true;
        let enableSound = true;

        // --- Sound Effect Setup ---
        const sounds = {
            correct: new Tone.PolySynth(Tone.Synth, { volume: -8 }).toDestination(),
            incorrect: new Tone.FMSynth({ volume: 0, harmonicity: 1.5, modulationIndex: 10, oscillator: { type: "sawtooth" }, envelope: { attack: 0.01, decay: 0.3, sustain: 0.01, release: 0.1 } }).toDestination(),
            click: new Tone.Synth({ volume: -15, oscillator: { type: 'triangle' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.01, release: 0.1 } }).toDestination(),
            fanfare: new Tone.PolySynth(Tone.Synth, { volume: -5 }).toDestination(),
            applause: new Tone.NoiseSynth({ noise: { type: 'pink' }, envelope: { attack: 0.01, decay: 0.8, sustain: 0.1 } }).toDestination()
        };
        const correctNotes = [["G4", "C5", "E5"], ["A4", "D5", "F#5"], ["B4", "E5", "G#5"]];
        let correctNoteIndex = 0;

        function playSound(type) {
            if (!enableSound || Tone.context.state !== 'running') return;
            const now = Tone.now();
            switch (type) {
                case 'correct':
                    sounds.correct.triggerAttackRelease(correctNotes[correctNoteIndex % 3], '16n', now);
                    correctNoteIndex++;
                    break;
                case 'incorrect':
                    sounds.incorrect.triggerAttackRelease("A2", "8n", now);
                    break;
                case 'click':
                    sounds.click.triggerAttackRelease("C6", "16n", now);
                    break;
                case 'fanfare':
                    sounds.fanfare.triggerAttackRelease(["C4", "E4", "G4", "C5"], "2n", now);
                    sounds.fanfare.triggerAttackRelease(["G4", "B4", "D5", "G5"], "2n", now + 0.5);
                    for (let i = 0; i < 10; i++) {
                        sounds.applause.triggerAttackRelease("4n", now + i * 0.1 + 0.2);
                    }
                    break;
            }
        }
        
        // --- End of Sound Effect Setup ---

        const startScreen = document.getElementById('startScreen');
        const quizScreen = document.getElementById('quizScreen');
        const resultScreen = document.getElementById('resultScreen');
        const settingsScreen = document.getElementById('settingsScreen');
        const quizModeSelect = document.getElementById('quizModeSelect');
        const startButton = document.getElementById('startButton');
        const settingsButton = document.getElementById('settingsButton');
        const backToStartButton = document.getElementById('backToStartButton');
        const questionTextElement = document.getElementById('questionText');
        const hintTextElement = document.getElementById('hintText');
        const optionsGridElement = document.getElementById('optionsGrid');
        const feedbackMessageElement = document.getElementById('feedbackMessage');
        const feedbackResultElement = document.getElementById('feedbackResult');
        const explanationContentElement = document.getElementById('explanationContent');
        const explanationTextElement = explanationContentElement.querySelector('.explanation-text');
        const toggleExplanationButton = document.getElementById('toggleExplanationButton');
        const nextButton = document.getElementById('nextButton');
        const interruptButton = document.getElementById('interruptButton');
        const progressBarContainer = document.querySelector('.progress-container');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const finalScore = document.getElementById('finalScore');
        const scoreComment = document.getElementById('scoreComment');
        const confettiContainer = document.getElementById('confettiContainer');
        const restartButton = document.getElementById('restartButton');
        const redoIncorrectButton = document.getElementById('redoIncorrectButton');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const themeColorCircles = document.querySelectorAll('.color-circle');
        const questionCountSelect = document.getElementById('questionCountSelect');
        const showProgressToggle = document.getElementById('showProgressToggle');
        const enableSoundToggle = document.getElementById('enableSoundToggle');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalConfirmButton = document.getElementById('modalConfirmButton');
        const modalCancelButton = document.getElementById('modalCancelButton');

        function showModal(title, message, onConfirm) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.classList.add('show');
            modalConfirmButton.onclick = () => { closeModal(); if (onConfirm) onConfirm(); };
            modalCancelButton.onclick = closeModal;
        }
        function closeModal() { modal.classList.remove('show'); }
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        const themes = { 'default':{light:{'--bg-primary':'#e0e7ff','--bg-secondary':'#ffffff','--text-primary':'#2c3e50','--text-secondary':'#7f8c8d','--button-bg-default':'#f0f4f8','--button-text-default':'#34495e','--button-border-default':'#dbe2ef','--nav-button-bg':'#6c5ce7','--nav-button-hover-bg':'#5a4acb','--nav-button-shadow':'rgba(108, 92, 231, 0.3)','--start-button-bg':'#2ecc71','--start-button-hover-bg':'#27ae60','--start-button-shadow':'rgba(46, 204, 113, 0.3)','--interrupt-button-bg':'#e74c3c','--interrupt-button-hover-bg':'#c0392b','--interrupt-button-shadow':'rgba(231, 76, 60, 0.3)','--progress-bar-bg':'#6c5ce7','--feedback-bg':'#fdfdfd','--feedback-border':'#e0e0e0','--correct-feedback-text':'#1a5e20','--correct-feedback-border':'#28a745','--incorrect-feedback-text':'#721c24','--incorrect-feedback-border':'#dc3545','--correct-option-bg':'#c8e6c9','--incorrect-option-bg':'#f0b2b2','--score-color':'#1e3a8a','--score-comment-color':'#4f46e5','--settings-button-bg':'#3498db','--settings-button-hover-bg':'#2980b9','--settings-button-shadow':'rgba(52, 152, 219, 0.3)'}},'red':{light:{'--bg-primary':'#ffe0e0','--bg-secondary':'#ffffff','--text-primary':'#4a1a1a','--text-secondary':'#8b4545','--button-bg-default':'#f8e0e0','--button-text-default':'#4a1a1a','--button-border-default':'#f0c0c0','--nav-button-bg':'#e74c3c','--nav-button-hover-bg':'#c0392b','--nav-button-shadow':'rgba(231, 76, 60, 0.3)','--start-button-bg':'#2ecc71','--start-button-hover-bg':'#27ae60','--start-button-shadow':'rgba(46, 204, 113, 0.3)','--interrupt-button-bg':'#6c5ce7','--interrupt-button-hover-bg':'#5a4acb','--interrupt-button-shadow':'rgba(108, 92, 231, 0.3)','--progress-bar-bg':'#e74c3c','--feedback-bg':'#fffafa','--feedback-border':'#f0d0d0','--correct-feedback-text':'#1a5e20','--correct-feedback-border':'#28a745','--incorrect-feedback-text':'#721c24','--incorrect-feedback-border':'#dc3545','--correct-option-bg':'#f8e0e0','--incorrect-option-bg':'#f0c0c0','--score-color':'#c0392b','--score-comment-color':'#e74c3c','--settings-button-bg':'#3498db','--settings-button-hover-bg':'#2980b9','--settings-button-shadow':'rgba(52, 152, 219, 0.3)'}},'green':{light:{'--bg-primary':'#e0ffe0','--bg-secondary':'#ffffff','--text-primary':'#1a4a1a','--text-secondary':'#458b45','--button-bg-default':'#e0f8e0','--button-text-default':'#1a4a1a','--button-border-default':'#c0f0c0','--nav-button-bg':'#2ecc71','--nav-button-hover-bg':'#27ae60','--nav-button-shadow':'rgba(46, 204, 113, 0.3)','--start-button-bg':'#6c5ce7','--start-button-hover-bg':'#5a4acb','--start-button-shadow':'rgba(108, 92, 231, 0.3)','--interrupt-button-bg':'#e74c3c','--interrupt-button-hover-bg':'#c0392b','--interrupt-button-shadow':'rgba(231, 76, 60, 0.3)','--progress-bar-bg':'#2ecc71','--feedback-bg':'#fafffa','--feedback-border':'#d0f0d0','--correct-feedback-text':'#1a5e20','--correct-feedback-border':'#28a745','--incorrect-feedback-text':'#721c24','--incorrect-feedback-border':'#dc3545','--correct-option-bg':'#e0f8e0','--incorrect-option-bg':'#f0c0c0','--score-color':'#27ae60','--score-comment-color':'#2ecc71','--settings-button-bg':'#3498db','--settings-button-hover-bg':'#2980b9','--settings-button-shadow':'rgba(52, 152, 219, 0.3)'}},'orange':{light:{'--bg-primary':'#fff0e0','--bg-secondary':'#ffffff','--text-primary':'#4a301a','--text-secondary':'#8b6a45','--button-bg-default':'#f8e8e0','--button-text-default':'#4a301a','--button-border-default':'#f0e0c0','--nav-button-bg':'#f39c12','--nav-button-hover-bg':'#e67e22','--nav-button-shadow':'rgba(243, 156, 18, 0.3)','--start-button-bg':'#2ecc71','--start-button-hover-bg':'#27ae60','--start-button-shadow':'rgba(46, 204, 113, 0.3)','--interrupt-button-bg':'#e74c3c','--interrupt-button-hover-bg':'#c0392b','--interrupt-button-shadow':'rgba(231, 76, 60, 0.3)','--progress-bar-bg':'#f39c12','--feedback-bg':'#fffaf0','--feedback-border':'#f0e0d0','--correct-feedback-text':'#1a5e20','--correct-feedback-border':'#28a745','--incorrect-feedback-text':'#721c24','--incorrect-feedback-border':'#dc3545','--correct-option-bg':'#f8e8e0','--incorrect-option-bg':'#f0e0c0','--score-color':'#e67e22','--score-comment-color':'#f39c12','--settings-button-bg':'#3498db','--settings-button-hover-bg':'#2980b9','--settings-button-shadow':'rgba(52, 152, 219, 0.3)'}} };
        const darkThemeColors = { '--bg-primary':'#1a1a2e','--bg-secondary':'#212a3d','--text-primary':'#e0e7ff','--text-secondary':'#9bb0d9','--button-bg-default':'#3a4a5c','--button-text-default':'#e0e7ff','--button-border-default':'#5c708a','--nav-button-bg':'#6a3a82','--nav-button-hover-bg':'#5a306e','--nav-button-shadow':'rgba(106, 58, 130, 0.3)','--start-button-bg':'#1e8247','--start-button-hover-bg':'#1a6e3c','--start-button-shadow':'rgba(30, 130, 71, 0.3)','--interrupt-button-bg':'#a93226','--interrupt-button-hover-bg':'#922a1f','--interrupt-button-shadow':'rgba(169, 50, 38, 0.3)','--progress-bar-bg':'#6a3a82','--feedback-bg':'#324054','--feedback-border':'#4a5a6e','--correct-feedback-text':'#c8e6c9','--correct-feedback-border':'#28a745','--incorrect-feedback-text':'#f0b2b2','--incorrect-feedback-border':'#dc3545','--correct-option-bg':'#2d6a4a','--incorrect-option-bg':'#8c3b3b','--score-color':'#e0e7ff','--score-comment-color':'#b886d9','--settings-button-bg':'#2471a3','--settings-button-hover-bg':'#1f608a','--settings-button-shadow':'rgba(36, 113, 163, 0.3)' };

        function applyColors(themeName, isDark) {
            const root = document.documentElement;
            const colorsToApply = isDark ? darkThemeColors : (themes[themeName]?.light || themes.default.light);
            for (const [prop, value] of Object.entries(colorsToApply)) {
                root.style.setProperty(prop, value);
            }
        }

        function setDarkMode(isDark) {
            document.body.classList.toggle('dark-mode', isDark);
            localStorage.setItem('darkMode', isDark);
            applyColors(localStorage.getItem('themeColor') || 'default', isDark);
        }

        function setThemeColor(themeName) {
            localStorage.setItem('themeColor', themeName);
            if (!document.body.classList.contains('dark-mode')) {
                applyColors(themeName, false);
            }
        }

        async function prepareQuiz() {
            if (Tone.context.state !== 'running') await Tone.start();
            playSound('click');
            currentMode = quizModeSelect.value;
            localStorage.setItem('lastSelectedMode', currentMode);
            questionCount = parseInt(questionCountSelect.value, 10);
            localStorage.setItem('questionCount', questionCount);
            currentQuestions = [];
            answeredQuestions.clear();
            sessionIncorrectQuestionIds = [];
            score = 0;
            currentQuestionIndex = 0;

            if (currentMode === 'random-10') {
                const shuffledAll = [...allQuestions];
                shuffleArray(shuffledAll);
                currentQuestions = shuffledAll.slice(0, questionCount);
            } else if (currentMode === 'incorrect') {
                currentQuestions = allQuestions.filter(q => incorrectQuestionIds.includes(q.id));
                if (currentQuestions.length === 0) {
                    showModal('苦手克服モード', '現在、間違えた問題がありません。他のモードで学習しましょう！');
                    quizModeSelect.value = 'random-10';
                    localStorage.setItem('lastSelectedMode', 'random-10');
                    return;
                }
                shuffleArray(currentQuestions);
            } else {
                currentLessonId = currentMode;
                currentQuestions = allQuestions.filter(q => q.lesson === currentLessonId);
                shuffleArray(currentQuestions);
                currentQuestions = currentQuestions.slice(0, questionCount);
            }

            startScreen.classList.remove('active');
            quizScreen.classList.add('active');
            resultScreen.classList.remove('active');
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestions.length === 0 || currentQuestionIndex >= currentQuestions.length) {
                showQuizResult();
                return;
            }
            const question = currentQuestions[currentQuestionIndex];
            questionTextElement.textContent = question.text;
            hintTextElement.textContent = question.hint;
            optionsGridElement.innerHTML = '';
            feedbackResultElement.innerHTML = '';
            feedbackMessageElement.classList.remove('correct-feedback', 'incorrect-feedback');
            explanationContentElement.classList.remove('show');
            explanationTextElement.textContent = '';
            toggleExplanationButton.classList.add('hidden');
            toggleExplanationButton.textContent = '解説▼';

            const shuffledOptions = [...question.options];
            shuffleArray(shuffledOptions);

            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('option-button');
                button.dataset.option = option;
                button.addEventListener('click', () => selectOption(option, question.answer, question.id));
                optionsGridElement.appendChild(button);
            });
            updateProgressBar();
            updateNavigationButtons();
        }

        function selectOption(selectedOption, correctAnswer, questionId) {
            if (answeredQuestions.has(questionId)) return;
            disableOptions();
            const currentQuestion = currentQuestions[currentQuestionIndex];

            if (selectedOption === correctAnswer) {
                playSound('correct');
                feedbackResultElement.innerHTML = `<strong>正解！</strong>`;
                feedbackMessageElement.classList.add('correct-feedback');
                score++;
                incorrectQuestionIds = incorrectQuestionIds.filter(id => id !== questionId);
            } else {
                playSound('incorrect');
                feedbackResultElement.innerHTML = `<strong>不正解...</strong> 正解は「${correctAnswer}」でした。`;
                feedbackMessageElement.classList.add('incorrect-feedback');
                if (!incorrectQuestionIds.includes(questionId)) incorrectQuestionIds.push(questionId);
                if (!sessionIncorrectQuestionIds.includes(questionId)) sessionIncorrectQuestionIds.push(questionId);
            }
            
            answeredQuestions.add(questionId);
            localStorage.setItem('incorrectQuestions', JSON.stringify(incorrectQuestionIds));

            optionsGridElement.querySelectorAll('.option-button').forEach(button => {
                if (button.dataset.option === correctAnswer) button.classList.add('correct');
                else if (button.dataset.option === selectedOption) button.classList.add('incorrect');
            });

            if (currentQuestion.explanation) {
                explanationTextElement.textContent = currentQuestion.explanation;
                toggleExplanationButton.classList.remove('hidden');
            }
            updateNavigationButtons();
        }

        function disableOptions() {
            optionsGridElement.querySelectorAll('.option-button').forEach(button => {
                button.disabled = true;
                button.style.cursor = 'default';
            });
        }

        function updateNavigationButtons() {
            nextButton.disabled = !answeredQuestions.has(currentQuestions[currentQuestionIndex]?.id);
            nextButton.textContent = (currentQuestionIndex === currentQuestions.length - 1 && !nextButton.disabled) ? '結果を見る' : '次の問題';
        }

        function updateProgressBar() {
            progressBarContainer.style.display = showProgress ? 'block' : 'none';
            progressText.style.display = showProgress ? 'block' : 'none';
            if (!showProgress) return;
            const total = currentQuestions.length;
            const progress = total > 0 ? (currentQuestionIndex + 1) / total : 0;
            progressBar.style.width = `${progress * 100}%`;
            progressText.textContent = total > 0 ? `${currentQuestionIndex + 1} / ${total} 問目` : `0 / 0 問目`;
        }

        function createConfetti() {
            confettiContainer.innerHTML = '';
            const colors = ['#f06', '#6cf', '#fc0', '#0c6', '#93f'];
            for (let i = 0; i < 80; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = (45 + Math.random() * 10) + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                const xEnd = Math.random() * 250 - 125;
                const yEnd = -200 - (Math.random() * 150);
                const rotation = Math.random() * 720 - 360;

                const animation = confetti.animate([
                    { transform: `translate(0, 0) rotate(0)`, opacity: 1 },
                    { transform: `translate(${xEnd * 0.5}px, ${yEnd}px) rotate(${rotation}deg)`, opacity: 1 },
                    { transform: `translate(${xEnd}px, 100vh) rotate(${rotation * 2}deg)`, opacity: 0 }
                ], {
                    duration: 2500 + Math.random() * 1500,
                    easing: 'cubic-bezier(0.1, 0.5, 0.5, 1)',
                    delay: Math.random() * 200
                });
                animation.onfinish = () => confetti.remove();
                confettiContainer.appendChild(confetti);
            }
        }

        function showQuizResult() {
            quizScreen.classList.remove('active');
            resultScreen.classList.add('active');
            finalScore.textContent = `あなたのスコア: ${score} / ${currentQuestions.length}`;

            const percentage = currentQuestions.length === 0 ? 0 : (score / currentQuestions.length) * 100;
            let comment = '';
            if (percentage === 100) {
                comment = '素晴らしい！満点です！🎉';
                playSound('fanfare');
                createConfetti();
            } else if (percentage >= 80) {
                comment = 'よくできました！この調子で頑張りましょう！✨';
            } else if (percentage >= 50) {
                comment = 'もう少しです！復習して、さらに上を目指しましょう！👍';
            } else {
                comment = '頑張ろう！基礎をしっかり固めていきましょう！💪';
            }
            scoreComment.textContent = comment;
            redoIncorrectButton.style.display = sessionIncorrectQuestionIds.length > 0 ? 'block' : 'none';
        }

        // Event Listeners
        startButton.addEventListener('click', prepareQuiz);
        nextButton.addEventListener('click', () => {
            playSound('click');
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                showQuizResult();
            }
        });
        settingsButton.addEventListener('click', () => {
            startScreen.classList.remove('active');
            settingsScreen.classList.add('active');
        });
        backToStartButton.addEventListener('click', () => {
            settingsScreen.classList.remove('active');
            startScreen.classList.add('active');
        });
        interruptButton.addEventListener('click', () => {
            showModal('クイズ中断', 'クイズを中断しますか？現在の進捗は失われます。', () => {
                quizScreen.classList.remove('active');
                startScreen.classList.add('active');
            });
        });
        restartButton.addEventListener('click', () => {
            playSound('click');
            resultScreen.classList.remove('active');
            startScreen.classList.add('active');
            confettiContainer.innerHTML = '';
        });
        redoIncorrectButton.addEventListener('click', () => {
            playSound('click');
            if (sessionIncorrectQuestionIds.length === 0) return;
            currentQuestions = allQuestions.filter(q => sessionIncorrectQuestionIds.includes(q.id));
            shuffleArray(currentQuestions);
            currentQuestionIndex = 0;
            score = 0;
            answeredQuestions.clear();
            sessionIncorrectQuestionIds = [];
            resultScreen.classList.remove('active');
            quizScreen.classList.add('active');
            loadQuestion();
        });
        toggleExplanationButton.addEventListener('click', () => {
            explanationContentElement.classList.toggle('show');
            toggleExplanationButton.textContent = explanationContentElement.classList.contains('show') ? '解説▲' : '解説▼';
        });
        darkModeToggle.addEventListener('change', (e) => setDarkMode(e.target.checked));
        themeColorCircles.forEach(circle => {
            circle.addEventListener('click', () => {
                themeColorCircles.forEach(c => c.classList.remove('selected'));
                circle.classList.add('selected');
                setThemeColor(circle.dataset.theme);
            });
        });
        questionCountSelect.addEventListener('change', (e) => localStorage.setItem('questionCount', e.target.value));
        showProgressToggle.addEventListener('change', (e) => {
            showProgress = e.target.checked;
            localStorage.setItem('showProgress', String(showProgress));
            updateProgressBar();
        });
        enableSoundToggle.addEventListener('change', (e) => {
            enableSound = e.target.checked;
            localStorage.setItem('enableSound', String(enableSound));
        });

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            const swScript = `const CACHE='v3';self.addEventListener('install',e=>e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['/','index.html']))));self.addEventListener('fetch',e=>e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))));`;
            const swBlob = new Blob([swScript], { type: 'application/javascript' });
            window.addEventListener('load', () => navigator.serviceWorker.register(URL.createObjectURL(swBlob)));
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            const manifestContent = { "name": "BEⅠ GS Quiz", "short_name": "BEⅠ Quiz", "description": "Basic English Grammar & Structure Quiz App", "start_url": ".", "display": "standalone", "background_color": "#e0e7ff", "theme_color": "#6c5ce7", "icons": [{ "src": "https://placehold.co/192x192/6c5ce7/ffffff?text=BE", "sizes": "192x192", "type": "image/png" }, { "src": "https://placehold.co/512x512/6c5ce7/ffffff?text=BE", "sizes": "512x512", "type": "image/png" }] };
            const blob = new Blob([JSON.stringify(manifestContent)], { type: 'application/json' });
            document.querySelector('link[rel="manifest"]').href = URL.createObjectURL(blob);

            const isDark = localStorage.getItem('darkMode') === 'true';
            darkModeToggle.checked = isDark;
            
            const savedTheme = localStorage.getItem('themeColor') || 'default';
            document.querySelector(`.color-circle[data-theme="${savedTheme}"]`)?.classList.add('selected');
            
            applyColors(savedTheme, isDark);

            const storedIncorrect = localStorage.getItem('incorrectQuestions');
            if (storedIncorrect) incorrectQuestionIds = JSON.parse(storedIncorrect);

            quizModeSelect.value = localStorage.getItem('lastSelectedMode') || 'random-10';
            questionCountSelect.value = localStorage.getItem('questionCount') || '10';
            showProgress = localStorage.getItem('showProgress') !== 'false';
            showProgressToggle.checked = showProgress;
            enableSound = localStorage.getItem('enableSound') !== 'false';
            enableSoundToggle.checked = enableSound;

            startScreen.classList.add('active');
        });
    </script>
</body>
</html>
